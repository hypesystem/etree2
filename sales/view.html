---
layout: default
---
<div class="prelaunch-container">
  <div class="head-text">
    <h1 class="headline">Køb Københavns <span>billigste</span> juletræer nu!</h1>
    <h3 class="subline">Høj kvalitet, dansk groet, leveres til døren.</h3>
  </div>
</div>
<div class="sign-up-bar">
    <h2>Salget er startet!</h2>
    <p>Vi fortsætter salget til d. 10. december, og leverer derefter træerne mellem d. 10 og 20. december.</p>
    <a href="#sales" class="btn large" data-scroll>Køb nu</a>
</div>
<div class="sales-container">

    <span id="start" class="target"><!-- Hidden anchor to close all modals --></span>
    <span id="about" class="target"><!-- Hidden anchor to open adjesting modal container--></span>
    <div class="modal">
      <div class="content vertical-align-middle">
        <h2 class="center-text">Postnumre vi leverer til</h2>
        <div>
          {{#allowedPostCodes}}
            {{ #exact }}
              <span class="exact-zip">{{ exact }}</span>
            {{ /exact }}
            {{ ^exact }}
              <p>Alle postnumre mellem <strong>{{min}}</strong> og <strong>{{max}}</strong></p>
              <p>Samt disse postnumre:</p>
            {{ /exact }}
          {{/allowedPostCodes}}
        </div>
        <a class="close-btn" href="#start">&#10005;</a>
      </div>
    </div>

    <div id="sales" class="container">
      <form action="/buy" method="post">
        <h1 class="center-text tree-size-h1">Vælg størrelse</h1>
        <p class="center-text">Klik for at vælge</p>

        <section class="trees">

          {{#treeSizes}}
          <input id="size-{{name}}" class="tree-size-input" type="radio" name="tree-size" value="{{name}}" required />
          <label for="size-{{name}}" class="tree-size-container">
            <div class="tree-size">
              <i class="fa fa-tree tree-icon-{{name}}" aria-hidden="true"></i>
              <h4>{{name}}</h4>
              <ul>
                <li>{{minHeight}}-{{maxHeight}} cm</li>
                {{#salesLimit}}
                <li>Kun {{salesLimit}} tilbage!</li>
                {{/salesLimit}}
                <li>Leveres til døren</li>
              </ul>
              <a class="btn">{{price}} kr<span class="checkmark-icon">&nbsp;&#10003;</span></a>
            </div>
          </label>
          {{/treeSizes}}

        </section>

        <section class="sales-options">
          <div class="option">
            <h3>Juletræsfod</h3>
            <p>Skal der sættes fod på dit træ?.</p>
            <div class="control-group">
              <label class="control control--radio">Sæt fod på det! (+50 kr)
                <input type="radio" id="tree-foot-true" name="tree-foot" value="yes" checked="true" />
                <div class="control__indicator"></div>
              </label>
              <label class="control control--radio">Nej tak
                <input type="radio" id="tree-foot-false" value="no" name="tree-foot" />
                <div class="control__indicator"></div>
              </label>
            </div>
          </div>

          <div class="option pickup">
            <h3>Levering</h3>
            <p>Vi kan udbringe i København og Storkøbenhavnsområdet.<br /><a href="#about">Se postnumre her.</a></p>
            {{^pickUpLocations.length}}
              <p>Levering koster <strong>{{ deliveryPrice }} kr</strong></p>
            {{/pickUpLocations.length}}

            {{#pickUpLocations.length}}
            <div class="control-group">
              <label class="control control--radio">Få udbragt træet (+100 kr)
                <input type="radio" id="pickup-false" name="delivery" value="yes" checked="checked" />
                <div class="control__indicator"></div>
              </label>
              <label class="control control--radio">Jeg henter selv
                <input type="radio" id="pickup-true" name="delivery" value="no" />
                <div class="control__indicator"></div>
              </label>
            </div>
            <div class="pickup-places">
              <h2 style="width:100%;">Vælg afhentningssted</h2>

              {{#pickUpLocations}}
                <input id="pickupPlace-{{name}}" value="{{name}}" type="radio" name="pickup-place" />
                <label for="pickupPlace-{{name}}" class="pickup-place-container">
                  <div class="pickup-place">
                    <img src="../assets/{{image}}" alt="" />
                    <div class="pickup-content">
                      <p><strong>{{name}}</strong><br />
                        {{address}}<br />
                        {{time}}
                      </p>
                      <a class="btn">Vælg<span class="checkmark-icon">&nbsp;&#10003;</span></a>
                    </div>
                  </div>
                </label>
              {{/pickUpLocations}}

              {{/pickUpLocations.length}}
            </div>

            <div class="option">
              <h3>Efter jul</h3>
              <p>Vi kan hente træet igen efter jul, så du er fri for selv at skille dig af med det.</p>
              <div class="control-group">
                <label class="control control--radio">Jeg kommer selv af med træet
                  <input type="radio" id="disposal-false" value="no" name="tree-disposal" checked="true" />
                  <div class="control__indicator"></div>
                </label>
                <label class="control control--radio">Få træet hentet efter jul (+200 kr)
                  <input type="radio" id="disposal-true" value="yes" name="tree-disposal" />
                  <div class="control__indicator"></div>
                </label>
              </div>
            </div>

        </section>

        <!-- Handle vouchers from query -->
        <input type="hidden" name="voucher" id="voucherField">
        <script>
            var voucherField = (function() {
                var voucherField = document.getElementById("voucherField");
                var voucherQueryMatch = /voucher=([^&]+)(&.*)?$/.exec(location.search);
                if(!voucherQueryMatch) {
                    return voucherField;
                }
                var voucher = voucherQueryMatch[1];
                voucherField.value = voucher;
                return voucherField;
            })();
        </script>
        <!-- /Handle vouchers from query -->

        <section class="customer-info">
          <h1 class="center-text">Kunde&shy;oplysninger</h1>
          <div class="address-container">
            <div class="address">
              <p><strong>Faktureringsadresse</strong></p>
                <label for="name">Fuldt navn</label>
                <input id="name" name="billing-name" type="text" required />
                <div class="flex-form">
                  <label for="streetname">Addresse</label>
                  <input id="streetname" name="billing-streetname" type="text" required />
                  <div class="zip-input">
                    <label for="zip">Postnummer</label>
                    <input id="zip" name="billing-zip" pattern="[0-9]{4}" type="text" required />
                  </div>
                  <div class="city-input">
                    <label for="city">By</label>
                    <input id="city" name="billing-city" type="text" required />
                  </div>
                  <label id="delivery-checkbox-container" class="control control--checkbox">Er det også leveringsadresse?
                    <input type="checkbox" id="delivery-checkbox" name="delivery-same-as-billing" checked="true" />
                    <div class="control__indicator"></div>
                  </label>
                </div>
            </div>
            <div class="address">
              <div id="deliveryAddress">
                <p><strong>Leveringsadresse</strong></p>
                <label for="delivery-name">Fuldt navn</label>
                <input id="delivery-name" name="delivery-name" type="text" />
                <div class="flex-form">
                  <label for="delivery-streetname">Addresse</label>
                  <input id="delivery-streetname" name="delivery-streetname" type="text" />
                  <div class="zip-input">
                    <label for="delivery-zip">Postnummer</label>
                    <input id="delivery-zip" name="delivery-zip" pattern="[0-9]{4}" type="text" />
                  </div>
                  <div class="city-input">
                    <label for="delivery-city">By</label>
                    <input id="delivery-city" name="delivery-city" type="text" />
                  </div>
                </div>
              </div>
              <div id="delivery-pickup-place" class="pickup-place-container" style="display:none;">
                <p style="text-align:left;"><strong>Leveringsadresse</strong></p>
                <div class="pickup-place">
                  <img src="../assets/firforest.jpg" alt="" />
                  <div class="pickup-content">
                    <p><strong>Strandvejen 267</strong><br />
                      Charlottenlund<br />
                      30. nov kl. 12-16
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="order-summary-container">
          <div class="address-contact">
            <p><strong>Kontaktoplysninger</strong></p>
            <label for="email">Email <span class="label-subtext">(påkrævet)</span></label>
            <input id="email" name="contact-email" type="email" placeholder="mikkel-l@rsen.dk" required />
            <label for="phone">Telefonnummer <span class="label-subtext">(valgfri)</span></label>
            <input id="phone" name="contact-phone" type="tel" placeholder="+45 21 43 54 76" />
            <label for="comments">Kommentare til ordren <span class="label-subtext">(valgfri)</span></label>
            <textarea id="comments" name="comments" rows="3" cols="50" placeholder="Tak for god service etree!"></textarea>
          </div>
          <div class="order-summary">
            <p><strong>Ordreoversigt</strong></p>
            <table class="order-table left-text">
              <thead>
                <tr>
                  <th data-field="id">Navn</th>
                  <th data-field="name">Pris</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span id="order-size">Intet</span> Juletræ</td>
                  <td><span id="order-price-tree">0</span> kr</td>
                </tr>
                <tr>
                  <td><span id="order-foot">&ndash; Med fod</span></td>
                  <td><span id="order-price-foot">50</span> kr</td>
                </tr>
                <tr>
                  <td>Levering</td>
                  <td>100 kr</td>
                </tr>
                <tr>
                  <td><span id="order-disposal"></span></td>
                  <td><span id="order-price-disposal"></span></td>
                </tr>
                <tr>
                  <td><span id="order-voucher"></span></td>
                  <td><span id="order-price-voucher"></span></td>
                </tr>
                <tr>
                  <td><strong>Total</strong></td>
                  <td><strong><span id="price-total">0</span> kr</strong></td>
              </tbody>
            </table>
          </div>
        </section>
        <div class="center-text">
          <button type="submit">Gå til betaling</button>
        </div>
      </form>
    </div>

</div>
<script>
  smoothScroll.init();
  checkDelivery();

  var treePrice = 0;
  var footPrice = {{footPrice}};
  var deliverPrice = {{deliveryPrice}};
  var disposalPrice = 0;

  //var currentTreeSize = null;
  //var currentFoot = null;
  //var currentDisposal = null;

  var voucherRebate = 0;
  var voucherFilters = [];
  var voucherName = null;

  getVoucherModifier();

  var pickupPlaces = document.querySelector(".pickup-places");
  if(pickupPlaces){
    pickupPlaces.style.display = "none";
  }

  // Onclick binders
  {{#treeSizes}}
    var treeSizeInput = document.querySelector("#size-{{name}}");
    treeSizeInput.addEventListener('click', function(){treeSizeForOrder('{{name}}','{{price}}')}, false);
  {{/treeSizes}}

  document.querySelector("#tree-foot-true").addEventListener('click', function(){footSizeForOrder(true)}, false);
  document.querySelector("#tree-foot-false").addEventListener('click', function(){footSizeForOrder(false)}, false);
  // document.querySelector("#pickup-false").addEventListener('click', function(){checkPickup()}, false);
  // document.querySelector("#pickup-true").addEventListener('click', function(){checkPickup()}, false);
  document.querySelector("#disposal-true").addEventListener('click', function(){afterChristmasOrder(true)}, false);
  document.querySelector("#disposal-false").addEventListener('click', function(){afterChristmasOrder(false)}, false);
  document.querySelector("#delivery-checkbox").addEventListener('click', function(){checkDelivery()}, false);

  function checkPickup() {
    if(document.getElementById('pickup-true').checked) {
      pickupPlaces.style.display = "flex";
      document.querySelector("#delivery-pickup-place").style.display = "block";
      document.querySelector("#deliveryAddress").style.display = "none";
      document.querySelector("#delivery-checkbox-container").style.display = "none";
    } else if (document.getElementById('pickup-false').checked) {
      pickupPlaces.style.display = "none";
      document.querySelector("#delivery-pickup-place").style.display = "none";
      document.querySelector("#deliveryAddress").style.display = "block";
      document.querySelector("#delivery-checkbox-container").style.display = "block";
      checkDelivery();
    }
  }

  function checkDelivery() {
    if(document.getElementById('delivery-checkbox').checked) {
      document.getElementById("deliveryAddress").style.display = "none";
    } else {
      document.querySelector("#deliveryAddress").style.display = "block";
      document.querySelector("#delivery-pickup-place").style.display = "none";
    }
  }

  function buildOrder() {
    treePrice = parseInt(treePrice);
    var total = treePrice + footPrice + deliverPrice + disposalPrice - voucherRebate;
    console.log("TOTAL Price: ",total);
    document.querySelector("#price-total").innerHTML = total;
  }

  function treeSizeForOrder(size, price) {
    var treeSize = size;
    treePrice = price;
    document.querySelector("#order-size").innerHTML = treeSize;
    document.querySelector("#order-price-tree").innerHTML = price;
    buildOrder();
  }

  function footSizeForOrder(foot) {
    if(foot){
      document.querySelector("#order-foot").innerHTML = "&ndash; med fod";
      document.querySelector("#order-price-foot").innerHTML = "{{footPrice}}";
      footPrice = {{footPrice}};
    } else {
      document.querySelector("#order-foot").innerHTML = "&ndash; uden fod";
      document.querySelector("#order-price-foot").innerHTML = "0";
      footPrice = 0;
    }
    buildOrder();
  }

  function afterChristmasOrder(disposal) {
    if(disposal){
      document.querySelector("#order-disposal").innerHTML = "Bliver afhentet efter jul";
      document.querySelector("#order-price-disposal").innerHTML = "{{collectionPrice}} kr";
      disposalPrice = {{collectionPrice}};
    } else {
      document.querySelector("#order-disposal").innerHTML = "";
      document.querySelector("#order-price-disposal").innerHTML = "";
      disposalPrice = 0;
    }
    buildOrder();
  }

  function getVoucherModifier() {
      if(!voucherField.value || voucherField.value == "") {
          return;
      }
      httpGetJson("/voucher/" + voucherField.value, function(error, status, result) {
          if(error) {
              voucherName = "Kupon ???";
              buildVoucherOrderLine();
              return console.error("Failed to get voucher details", error);
          }
          if(status == 404) {
              return;
          }
          if(status != 200) {
              voucherName = "Kupon ???";
              buildVoucherOrderLine();
              return console.error("Failed to get voucher, got status", status);
          }
          if(!result.active) {
              return console.log("Voucher has already been used");
          }
          voucherFilters = result.filters;
          voucherRebate = result.rebate;
          voucherName = result.name;
          buildVoucherOrderLine();
      });
  }

  function httpGetJson(uri, callback) {
      var req = new XMLHttpRequest();
      req.addEventListener("load", function() {
          var json;
          try {
              json = JSON.parse(this.responseText);
          }
          catch(e) {
              return callback(e);
          }
          callback(null, this.status, json);
      });
      req.open("GET", uri);
      req.send();
  }

  //TODO: Voucher filters (once we introduce vouchers not only for delivery, or when we introduce pickup locations)
  function buildVoucherOrderLine() {
      document.querySelector("#order-voucher").innerHTML = voucherName;
      document.querySelector("#order-price-voucher").innerHTML = "- " + voucherRebate + " kr";
      buildOrder();
  }

</script>
